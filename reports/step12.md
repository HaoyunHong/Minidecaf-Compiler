# Report

洪昊昀    计82    2017010591

## 1. 任务

需要支持数组和指针算术。

## 2. 实验内容

修改或新增的语法规范如下：

```
decl
    : ty Ident ('[' Integer ']')* ('=' expr)?
    ;
    
postfix
    : atom
    | postfix '[' expr ']'
    | Ident '(' argList ')'
    ;
```

step 12 的代码量也很大：

1. 代码中新增了数组类与相关函数，数组的大小比较需要根据其内容比较。
2. 注意下标运算符只能作用于指针或是数组变量，不能对数组变量解引用和取引用，左值检查和类型检查和 step11 相似。
3. 我使用了双向队列的数据结构实现多维数组，数组各维长度必须是正整数，要实现对应的语义检查。

## 3. 思考题

### 3.1

设有以下几个函数，其中局部变量 `a` 的起始地址都是 `0x1000`(4096)，请分别给出每个函数的返回值。

B: `*(int*)(4096 + 23 * 4)`
C: `*(int*)(4096 + 2 * 10 * 4 + 3 * 4)`
D: `*(int*)(*(int*)(4096 + 2 * 4) + 3 * 4)`
E: `*(int*)(*(int*)(4096 + 2 * 4 ) + 3 * 4)`

### 3.2

如果我们决定支持一维的可变长度的数组(即允许类似 `int n = 5; int a[n];` 这种，但仍然不允许类似 `int n = ...; int m = ...; int a[n][m];` 这种)，而且要求数组仍然保存在栈上（即不允许用堆上的动态内存申请，如`malloc`等来实现它），应该在现有的实现基础上做出那些改动？

由提示可知，当存在两个以上的变长数组时，至少有一个数组的起始地址不能在编译时决定。所以要在运行时根据维度变量的值动态分配栈帧，在运行时也需要在栈中把局部变量的地址保存下来。

## 4.

在step11的基础上，我主要借鉴了参考代码中irgen和name的部分，在这次实验中我对如何处理全局变量的理解更加深入 了，也能够在有bug的参考实现的思路的基础上根据自己的理解实现正确的代码。

