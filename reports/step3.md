
# Report

洪昊昀    计82    2017010591

## 1. 任务

要增加操作符：加 `+`、减 `-`、乘 `*`、整除 `/`、模 `%` 以及括号 `(` `)`。

## 2. 实验内容

修改语法规范来满足ANTLR的要求，然后实现二元操作的 IR，当遍历 AST 遇到二元操作时，首先让左操作数入栈成为栈顶，然后让右操作数入栈成为栈顶，再根据不同的操作生成对应的 IR，再使用gcc 确定 `sub`/`mul`/`div`/`rem` 的汇编。

## 3. 思考题

### 3.1 

(1) 请给出将寄存器 `t0` 中的数值压入栈中所需的 riscv 汇编指令序列；(2) 请给出将栈顶的数值弹出到寄存器 `t0` 中所需的 riscv 汇编指令序列。

(1)

```assembly
addi sp, sp, -4
sw t0, 0(sp)
```

(2)

```assembly
lw t0, 0(sp)
addi sp, sp, 4
```

### 3.2

语义规范中规定“除以零、模零都是未定义行为”，但是即使除法的右操作数不是 0，仍然可能存在未定义行为。请问这时除法的左操作数和右操作数分别是什么？请将这时除法的左操作数和右操作数填入下面的代码中，分别在你的电脑（请标明你的电脑的架构，比如 x86-64 或 ARM）中和 RISCV-32 的 qemu 模拟器中编译运行下面的代码，并给出运行结果。

这时除法的左操作数和右操作数分别是 -2147483648 和 -1，此时会发生溢出。

x86-64 电脑

```bash
Floating point exception (core dumped)
```

RISCV-32 的 qemu 模拟器

```
-2147483648
```

## 4.

在step1的基础上，我主要借鉴了参考代码中ir和asm的部分，虽然我没有办法完全靠自己写出来，但已经理解了它的思路。相比做 step1 时的手足无措，在这次实验中我对实验的理解更加深入了。