# Report

洪昊昀    计82    2017010591

## 1. 任务

要增加编译器的块语句支持。

## 2. 实验内容

修改或新增的语法规范如下：

```
func
    : ty 'main' '(' ')' block
    ;
stmt
    : 'return' expr ';' # returnStmt
    | decl ';' # declStmt
    | expr ';' # exprStmt
    | ';' # nullStmt
    | 'if' '(' expr ')' th=stmt ('else' el=stmt)? # IfStmt
    | block # blockStmt
    ;
```

## 3. 思考题

### 3.1请将下述 MiniDecaf 代码中的 `???` 替换为一个 32 位整数，使得程序运行结束后会返回 0。

 `???` 为0就可以，因为此时`if(x)`中`x`为假，所以就会进入`else`分支，分支里的`x`是局部变量，出分支后就不存在了，所以`return x`就是返回0。

### 3.2 在实验指导中，我们提到“就 MiniDecaf 而言，名称解析的代码也可以嵌入 IR 生成里”，但不是对于所有语言都可以把名称解析嵌入代码生成。试问被编译的语言有什么特征时，名称解析作为单独的一个阶段在 IR 生成之前执行会更好？

当被编译的语言可以在前面使用变量，在后面声明变量的时候，或者是被编译的语言有namespace特性时（但这种情况不是完全不能把名称解析嵌入代码生成），名称解析作为单独的一个阶段在 IR 生成之前执行会更好。

## 4.

在step6的基础上，我主要借鉴了参考代码中irgen和name的部分，在这次实验中我对作用域和块语句的理解更加深入 了，也能够在有bug的参考实现的思路的基础上根据自己的理解实现正确的代码。

